## 2020-12-31 åŸç”ŸJSå®ç°æ—¥å†

[[toc]]

<img src="./imgs/calendar-1763587_640.png" />


### Step 0ï¼šèƒŒæ™¯ä»‹ç»

åœ¨å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨ç¬¬ä¸‰æ–¹çš„UIç»„ä»¶åº“æ¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®Œæˆå·¥ä½œå¼€å‘çš„éœ€æ±‚ï¼Œä½†æ˜¯æœ‰äº›åœºæ™¯ä¸‹æˆ‘ä»¬ä¹Ÿä¸å¾—ä¸åº”å¯¹UIè®¾è®¡æ—¥å†ç»„ä»¶ç”¨ä¸‰æ–¹åº“ä¹Ÿæ— æ³•ç†è§£æ»¡è¶³éœ€æ±‚ï¼Œè¿™æ—¶å€™äº†è§£æ—¥å†çš„åŸºæœ¬å®ç°åº”å¯¹è¿™äº›éœ€æ±‚ä¹Ÿä¸ä¼šå¾ˆæ…Œäº†ï¼Œå¤§ä¸äº†å°±è‡ªå·±å®ç°ä¸€ä¸ªğŸ˜†

::: tip

æœ¬æ–‡ä¸­æ—¥å†é‡‡ç”¨åŸç”Ÿjså¼€å‘ï¼Œæ— éœ€ä»»ä½•ä¸‰æ–¹ä¾èµ–åŒ…(é¡ºå¸¦ä¹Ÿç®—å¥½å¥½å›é¡¾ä¸‹å¿«å¿˜è®°çš„åŸç”Ÿå¼€å‘ï¼Œæ¯•ç«Ÿæ¡†æ¶ç”¨å¤šäº†ã€‚ã€‚)ï¼Œåé¢è‡ªå·±é›†æˆåˆ°`vue`æˆ–è€…`react`ä¹Ÿååˆ†æ–¹ä¾¿

:::

### Step 1ï¼š å‰ç½®çŸ¥è¯†

> åœ¨å¼€å‘æ—¥å†ç»„ä»¶å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸ªå‰ç½®çŸ¥è¯†ï¼Œå°±æ˜¯JavaScriptçš„å†…ç½®å¯¹è±¡`Date`ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å®ƒå†…éƒ¨çš„æ–¹æ³•å±æ€§æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚



```javascript
// å®ä¾‹åŒ–Date
const now = new Date()
// åœ¨æ§åˆ¶å°ä¸­æ‰“å°nowä¼šå¾—åˆ°å¦‚ä¸‹çš„ä¿¡æ¯
'Thu Dec 31 2020 18:02:15 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)'
// å…¶å®nowä¼šæ‰§è¡Œ æ‰ä¼šæœ‰ä»¥ä¸‹å†…å®¹
now[Symbol.toPrimitive]('default')
'Thu Dec 31 2020 18:02:15 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)'

// è·å–å¹´
now.getFullYear()
// è·å–æœˆ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œjså¯¹æœˆçš„å®ç°è¿”å›å€¼æ˜¯ä»0-11å³0->1æœˆï¼Œ11-> 12æœˆ
now.getMonth()
// è·å–æ—¥
now.getDate()
// è·å–æ˜ŸæœŸ æ˜ŸæœŸçš„æ’åˆ—ç¨å¾®æœ‰ç‚¹å·®å¼‚å°±æ˜¯å‘¨æ—¥å¯¹åº”çš„å€¼æ˜¯0ï¼Œå…¶ä»–æ˜ŸæœŸéƒ½æ˜¯æ­£å¸¸
// [0,1,2,3,4,5,6] => ['æ˜ŸæœŸæ—¥','æ˜ŸæœŸä¸€','æ˜ŸæœŸäºŒ','æ˜ŸæœŸä¸‰','æ˜ŸæœŸå››','æ˜ŸæœŸäº”','æ˜ŸæœŸå…­']
now.getDay()

// è®¾ç½®å¹´ä»½
now.setFullYear()
// è®¾ç½®æœˆä»½
now.setMonth()
// è®¾ç½®æ—¥æœŸ
now.setDate()
// ä»¥ä¸Šå‡ ä¸ªapiå°±å¤Ÿæˆ‘ä»¬å¼€å‘æ—¥å†ç»„ä»¶çš„äº†
```

[æ›´å¤šçš„apiå†…å®¹è¯·ç‚¹æ­¤](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date)

::: warning
è¿™é‡Œæ€è€ƒä¸€ä¸ªé—®é¢˜ğŸ¤”ï¼Œæˆ‘ä»¬åœ¨åšæ—¥å†çš„æ—¶å€™è‚¯å®šä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æ€ä¹ˆçŸ¥é“å½“å¹´å±•ç¤ºçš„è¿™ä¸ªæœˆä»½çš„å¤©æ•°å‘¢ï¼Ÿæ¯•ç«Ÿæ¯ä¸ªæœˆå¤©æ•°éƒ½æ˜¯ä¸ä¸€å®šçš„ï¼Œæœ‰31ï¼Œ30ï¼Œ29ï¼Œ28å¤©ï¼Œè¯•ç€ç»“åˆä¸Šé¢å‡ ä¸ªapiæƒ³æƒ³è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿå¸¦ç€è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å…ˆè¿›å…¥ä¸‹é¢çš„stepå§ï¼
:::

### Step 2ï¼š éœ€æ±‚ç®€å•åˆ†æ
å…ˆçœ‹ä¸‹å®ç°çš„ç®€å•çš„ç•Œé¢å§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º

<img src="./imgs/1.png" style="border:1px solid #eee"/>

åˆ†æä¸‹æ—¥å†ç»„ä»¶çš„åŸºæœ¬åŠŸèƒ½

- å±•ç¤ºå½“å‰æœˆä»½çš„æ‰€æœ‰æ—¥æœŸ+ä¸Šä¸ªæœˆçš„å°¾å·´+ä¸‹ä¸ªæœˆçš„å¤´å‡ å¤©ï¼Œæ˜¾ç¤ºæ ·å¼ä¸åŒï¼ˆæ—¥å†çš„ä¸»è¦æ„æˆï¼‰
- æ—¥æœŸä»å‘¨æ—¥å‘¨ä¸€ã€‚ã€‚æ’åˆ—
- headerä¸Šå±•ç¤ºå½“å‰å±•ç¤ºçš„å¹´-æœˆä»½
- ç‚¹å‡»headeræ çš„æŒ‰é’®å¯ä»¥åˆ‡æ¢å‰åæœˆä»½ï¼Œå‰åå¹´ä»½
- ç‚¹å‡»æ—¥æœŸé€‰ä¸­ï¼Œå¦‚æœç‚¹ä¸­çš„æ—¥æœŸä¸å±äºå½“å‰æœˆï¼Œåˆ‡æ¢åˆ°ç‚¹å‡»çš„æœˆä»½ä¸Š
- æ¯ä¸€ä¸ªæ ¼å­å†…å¯ä»¥å¡«å……å†…å®¹
- ç»™ä»Šå¤©åšç‰¹æ®Šæ ‡è®°
- ã€‚ã€‚ã€‚

ç®€å•åˆ†æäº†ä¸‹æ‰€éœ€è¦å®ç°çš„åŠŸèƒ½ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬å®ç°ä¸‹å¸ƒå±€



### Step 3ï¼šå¸ƒå±€å®ç°
åˆ›å»ºå¦‚ä¸‹ç›®å½•
```
â”œâ”€â”€demo
â”œâ”€â”€--js
â”œâ”€â”€--â”œâ”€â”€index.js
â”œâ”€â”€--â”œâ”€â”€api.js
â”œâ”€â”€--css
â”œâ”€â”€--â”œâ”€â”€index.less
â”œâ”€â”€--index.html
```
> è¿™é‡Œä¸ºäº†æ–¹ä¾¿ä¹¦å†™cssï¼Œç¬”è€…ä½¿ç”¨äº†lessé¢„å¤„ç†å™¨ï¼Œä¹Ÿç®—å·ä¸ªæ‡’ï¼Œåªéœ€è¦å¼•å…¥less.jså°±å¯ä»¥æ–¹ä¾¿çš„ä¹¦å†™lessäº†

```js
<script src="//cdn.jsdelivr.net/npm/less@3.13"></script>
```

æ¥ä¸‹æ¥å…ˆç”»htmléª¨æ¶

```html
<div class="calendar-wrap">
            <div class="calendar-header">
                <div class="calendar-header-content">
                    <span class="calendar-header-dir calendar-header-left" data-year="-1">ä¸Šä¸€å¹´</span>
                    <span class="calendar-header-dir calendar-header-left" data-month="-1">ä¸Šä¸ªæœˆ</span>
                    <h2 id="calendar-headar-titile">-</h2>
                    <span class="calendar-header-dir calendar-header-right" data-month="1">ä¸‹ä¸ªæœˆ</span>
                    <span class="calendar-header-dir calendar-header-right" data-year="1">ä¸‹ä¸€å¹´</span>
                </div>
            </div>
            <div class="calendar-panel">
                <div class="calendar-date-panel">
                    <div class="calendar-date-body">
                        <div class="calendar-date-content">
                            <div class="calendar-date-header">
                                <div class="calendar-item">æ—¥</div>
                                <div class="calendar-item">ä¸€</div>
                                <div class="calendar-item">äºŒ</div>
                                <div class="calendar-item">ä¸‰</div>
                                <div class="calendar-item">å››</div>
                                <div class="calendar-item">äº”</div>
                                <div class="calendar-item">å…­</div>
                            </div>
                            <div class="calendar-date-tbody-content">
                              <div class="calendar-date-tbody">
                                  <div class="calendar-item active">
                                      <div class="calendar-item-header">1</div>
                                      <div class="calendar-item-content"></div>
                                  </div>
                                  <div class="calendar-item">
                                      <div class="calendar-item-header">1</div>
                                      <div class="calendar-item-content"></div>
                                  </div>
                                  <div class="calendar-item">
                                      <div class="calendar-item-header">1</div>
                                      <div class="calendar-item-content"></div>
                                  </div>
                                  <div class="calendar-item">
                                      <div class="calendar-item-header">1</div>
                                      <div class="calendar-item-content"></div>
                                  </div>
                                  <div class="calendar-item">
                                      <div class="calendar-item-header">1</div>
                                      <div class="calendar-item-content"></div>
                                  </div>
                                  <div class="calendar-item">
                                      <div class="calendar-item-header">1</div>
                                      <div class="calendar-item-content"></div>
                                  </div>
                                  <div class="calendar-item">
                                      <div class="calendar-item-header">1</div>
                                      <div class="calendar-item-content"></div>
                                  </div>
                              </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
```

Css æ–¹é¢ç¬”è€…ä½¿ç”¨gridå¸ƒå±€å»åšäº†ä¸»ä½“çš„å®ç°

```less
.calendar-date-tbody {
    display: grid;
  	// è®¾ç½®7åˆ—ï¼Œæ¯åˆ—å¹³åˆ†æ€»ä½“å®½åº¦
    grid-template-columns: repeat(7, 1fr);
    // æ¯ä¸ªgridè¡Œçš„ç©ºéš™
  	grid-row-gap: 8px;
  	// æ¯ä¸ªgridå’Œåˆ—çš„ç©ºéš™
    grid-column-gap: 8px;
    text-align: right;
    & > .calendar-item {
      position: relative;
      transition: all .3s;
      display: block;
      padding: 4px 8px 0;
      min-width: 24px;
      width: 100%;
      border-top: 2px solid rgb(240,240,240);
      cursor: pointer;
      &:hover {
        background: rgba(238, 238, 238, 0.6);
      }
      &.calendar-item-before-month, &.calendar-item-after-month {
        color: rgba(0, 0, 0, 0.25);
      }
      // è®¾ç½®ç‚¹å‡»åæ˜¾ç¤ºçš„activeæ ·å¼
      &.active {
        background: var(--theme-opacity-lower-color);
        color: var(--theme-color);
      }
      // ä»Šå¤©çš„activeæ ·å¼
      &.now-active {
        border-color: var(--theme-color);
        color: var(--theme-color);
      }
      .calendar-item-header {
        line-height: 24px;
      }
      .calendar-item-content {
        height: 80px;
        overflow-x: hidden;
        overflow-y: auto;
        text-align: left;
      }
    }
  }
}
```

ä¸å‡ºæ„å¤–ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„å›¾

<img src="./imgs/2.png"/>

**ä½†æ˜¯ï¼Œå…¶å®æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±å¯¹cssç†è§£ï¼Œè¿™éƒ¨åˆ†å…¶å®ä¸æ˜¯å¾ˆé‡è¦ï¼Œåªè¦èƒ½åšå‡ºç›¸åŒçš„æ•ˆæœå°±å¯ä»¥äº†ï¼Œè¿™é‡Œè´´å¾—ä»£ç ä»…ä¾›å‚è€ƒ~**

### Step 4ï¼šä¸»ä½“åŠŸèƒ½å®ç°

> è¿˜è®°å¾—æˆ‘ä»¬ä¸Šé¢æåˆ°çš„é—®é¢˜å—ï¼Ÿæ€ä¹ˆå»è·å–å½“å‰æœˆä»½çš„å¤©æ•°å‘¢ï¼Ÿå…¶å®åªè¦èƒ½è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æœ€å¤§çš„é—®é¢˜å°±è¿åˆƒè€Œè§£äº†

è¿™é‡Œè¿˜å¾—å•°å—¦ä¸€å¥ï¼Œå…³äºDateå®ä¾‹çš„å¯¹è±¡é—®é¢˜

```js
const now = new Date()
// è¿™é‡Œå®ä¾‹åŒ–çš„å¯¹è±¡å…¶å®ç®—æ˜¯å¼•ç”¨ç±»å‹ï¼Œåƒä¸‡è¦æ³¨æ„ä¼ é€’å‚æ•°æ—¶ï¼Œæ”¹å˜è¿™ä¸ªå¯¹è±¡çš„åæœ
// æ¯”å¦‚å¦‚ä¸‹ è¿™æ ·ä¿®æ”¹ånowå€¼å°±è¢«æ”¹å˜äº†ï¼Œæ‰€æœ‰ä½¿ç”¨å®ƒçš„åœ°æ–¹ï¼Œéƒ½ä¼šå‘ç”Ÿå˜æ¢
now.setDate(1)

function setNewDate(date, addNum) {
  // å¤–é¢ä¼ å…¥çš„dateä¹Ÿä¼šå˜
  date.setDate(addNum)
}

// å½“å½“å‰æœˆæœ‰31å¤©ä¸”æ—¥æœŸæ˜¯31å·è€Œä¸Šä¸ªæœˆæœ‰30å¤©çš„æ—¶å€™
// æ¯”å¦‚ä»Šå¤©æ˜¯12æœˆ31æ—¥
const now = new Date()
// æŠŠæœˆä»½è®¾ç½®ä¸º11æœˆ
now.setMonth(10)

// è¿™ä¸ªæ—¶å€™ï¼Œå…¶å®now.getMonth()è¿˜æ˜¯12æœˆ
// å› ä¸ºæŠŠå½“å‰æœˆè®¾ç½®ä¸º11æœˆæ—¶ï¼Œ11æ²¡æœ‰31å·ï¼Œè®¾ç½®å¤±è´¥ï¼Œå¯¼è‡´æœˆä»½è¿˜æ˜¯æ˜¾ç¤ºçš„12æœˆï¼Œä½ å¯ä»¥è¯•è¯•ä¸‹é¢çš„ä¾‹å­
const now = new Date('2020/12/31')
now.setMonth(10)
now.getMonth()
```

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è§£å†³ä¸‹ç®—æœˆä»½å¤©æ•°çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿™æ ·æƒ³ï¼Œå…¶å®åªéœ€è¦æŠŠå½“å‰æœˆåŠ 1å¹¶è®¾ç½®ä¸ºä¸‹æœˆçš„1å·å†å‡1ï¼Œè¿™æ ·å°±å¯ä»¥ç®—å‡ºå½“å‰æœˆçš„æœ€åä¸€å¤©æ˜¯å‡ å·äº†ï¼Œè¿™ä¹ˆè¯´å¯èƒ½è¿˜ä¸ç›´è§‚

```js
// ä¸¾ä¸ªä¾‹å­
// 2020-12-28 å¢åŠ ä¸€ä¸ªæœˆå¹¶è®¾ç½®ä¸ºå½“å‰æœˆçš„1å· å°±å˜æˆäº† -> 2021-01-01 
// æ¥ä¸‹æ¥å†å‡å»ä¸€å¤©å°±èƒ½å¾—åˆ° -> 2020-12-31 æˆ‘ä»¬ç”¨ä»£ç å®ç°ä¸‹

let currentDate = new Date()
// è®¾ç½®ä¸ºä¸€ä¸‹æœˆçš„ç¬¬ä¸€å¤©
currentDate.setMonth(currentDate.getMonth() + 1, 1)
// è·å–åˆ°çš„å½“å‰æ—¥æœŸçš„æœ€åä¸€å¤©
currentDate.setDate(currentDate.getDate() - 1)

// æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ
```

æ¥ä¸‹é‡Œæˆ‘ä»¬å®ç°ä¸‹è¿™ä¸ªè·å–æ•´ä¸ªæœˆçš„å‡½æ•°

```js
**
 * æ ¹æ®ä¼ å…¥çš„æ—¶é—´ï¼Œè·å–ä¼ å…¥æ—¶é—´çš„å¼€å§‹æ—¥æœŸåˆ°ç»“æŸæ—¥æœŸ
 * @param {*} date 
 */
export function getDaysByMonth (date) {
    // é¿å…dateå¼•ç”¨
    let currentDate = new Date(date)
    // è®¾ç½®ä¸ºä¸€ä¸‹æœˆçš„ç¬¬ä¸€å¤©
    currentDate.setMonth(currentDate.getMonth() + 1, 1)
    // è·å–åˆ°çš„å½“å‰æ—¥æœŸçš„æœ€åä¸€å¤©
    currentDate.setDate(currentDate.getDate() - 1)

    const lastDate = currentDate.getDate()
    let result = []
    for (let i = 1; i <= lastDate; i++) {
        let scopeDate = new Date(currentDate.setDate(i))
        
        const formateDate = format(scopeDate)
        const element = {
            date: scopeDate,
            formateDate,
            year: formateDate.split('-')[0],
            month: formateDate.split('-')[1],
            day: formateDate.split('-')[2]
        }
        result = [...result, element]
    }
    return result
}
```

ä¸‹é¢æˆ‘ä»¬éœ€è¦è·å–ä¸Šä¸‹ä¸‰ä¸ªæœˆçš„æ—¥æœŸ

```js
// totalCount ä¸ºé»˜è®¤å¡«æ»¡6ä¸ªå‘¨æœŸ 6 * 7
export function getTotalDate(date, totalCount = 42) {
    const nowDate = date ? new Date(date) : new Date()
    
    const beforeMonth = new Date(nowDate).setMonth(nowDate.getMonth() - 1, 1)
    const nowMonth = new Date(nowDate).setMonth(nowDate.getMonth(), 1)
    const afterMonth = new Date(nowDate).setMonth(nowDate.getMonth() + 1, 1)

    const beforeDates = getDaysByMonth(beforeMonth)
    const nowDates = getDaysByMonth(nowMonth)
    const afterDates = getDaysByMonth(afterMonth)

    return [...beforeDates, ...nowDates, ...afterDates]
}
```

ä½†æ˜¯è¿™ä¹ˆå¹²ï¼Œä¼šè¿”å›èµ·ç æ¥è¿‘90+çš„æ—¥æœŸï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦è¿‡è™‘å‰åä¸¤ä¸ªæœˆçš„æ—¥å­ï¼Œå»é™¤å¤§éƒ¨åˆ†ä¸éœ€è¦å±•ç¤ºåœ¨æ—¥å†ä¸Šçš„æ—¥å­ã€‚

| å‘¨æ—¥ | å‘¨ä¸€ | å‘¨äºŒ | å‘¨ä¸‰ | å‘¨å›› | å‘¨äº” | å‘¨å…­ |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 0\|7 | 1    | 2    | 3    | 4    | 5    | 6    |

çœ‹ä¸Šé¢çš„è¡¨æ ¼ç¬¬ä¸€æ ¼æ˜¯å‘¨æœ«ï¼Œå¯¹åº”æˆ‘ä»¬`date.getDay() = 0`çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å‡è®¾ï¼Œé»˜è®¤æœ€å¤§çš„æ€»æ ¼å­æ•°ä¸º42æ ¼ï¼Œ6å‘¨ï¼ŒåŸºæœ¬æ˜¯æˆ‘ä»¬è€ƒè™‘æœ€å¤šçš„æ—¥å­çš„æƒ…å†µã€‚

ç„¶åæˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªè§„å¾‹

- å½“å½“å‰æœˆä»½1å·ä¸ºå‘¨æœ«çš„æ—¶å€™ï¼Œåˆšå¥½é¡¶æ ¼æ˜¾ç¤ºï¼Œä¸éœ€è¦ä¸Šä¸ªæœˆå†…å®¹

- å½“å½“å‰æœˆä»½1å·ä¸ºå‘¨1çš„æ—¶å€™ï¼Œä¸Šä¸ªæœˆéœ€è¦1å¤©
- å½“å½“å‰æœˆä»½1å·ä¸ºå‘¨2çš„æ—¶å€™ï¼Œä¸Šä¸ªæœˆéœ€è¦2å¤©
- ã€‚ã€‚ã€‚

æˆ‘ä»¬å¯ä»¥ç»™å‡º`beforeDates.slice(beforeDates.length - å½“å‰æœˆçš„1å·çš„getDay(), beforeDates.length)`

å‰©ä¸‹çš„æ—¥å­æˆ‘ä»¬å‡å®šä¸º`42 - beforeDates.length - å½“å‰æœˆçš„1å·çš„getDay()`ï¼Œè¿™æ˜¯å¦‚æœæ»¡æ ¼42æ ¼æƒ…å†µä¸‹ï¼Œä¸‹æœˆå¡«å……çš„æ—¥å­æ•°é‡ï¼Œå…¶å®ä¸€èˆ¬åšåˆ°è¿™ç›´æ¥å–è¿™ä¸ªæ•°é‡çš„ä¸‹ä¸ªæœˆæ—¥å­å°±è¡Œäº†ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è¦å°½å¯èƒ½å°‘çš„å†…å®¹ï¼Œæˆ‘ä»¬å°±å¾—ç»§ç»­åˆ¤æ–­æ¥ä¸‹æ¥çš„æ—¥å­è§„å¾‹ï¼š

å¦‚æœå¡«å……çš„æ•°é‡è¶…è¿‡7çš„è¯ï¼Œæˆ‘ä»¬ç›´æ¥ä¸è¦äº†ï¼Œ7ä»¥å†…çš„éƒ½è¦ï¼Œå°±åˆšå¥½ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼Œä¸ºæ­¤æˆ‘ä»¬åªéœ€è¦æŠŠå‰©ä¸‹çš„æ—¥å­å¯¹7å–ä½™å°±å¥½äº†ã€‚

okï¼Œè§£å†³å®Œæ¯•è¿™äº›å°é—®é¢˜ï¼Œå®Œå–„ä¸‹æˆ‘ä»¬çš„å‡½æ•°å¦‚ä¸‹

```js
export function getTotalDate(date, totalCount = 42) {
    const nowDate = date ? new Date(date) : new Date()
    
    const beforeMonth = new Date(nowDate).setMonth(nowDate.getMonth() - 1, 1)
    const nowMonth = new Date(nowDate).setMonth(nowDate.getMonth(), 1)
    const afterMonth = new Date(nowDate).setMonth(nowDate.getMonth() + 1, 1)

    const beforeDates = getDaysByMonth(beforeMonth)
    const nowDates = getDaysByMonth(nowMonth)
    const afterDates = getDaysByMonth(afterMonth)

    const remain = totalCount - nowDates.length
    const header = nowDates[0].date.getDay()
    const end = remain - header

    return [...(beforeDates.slice(beforeDates.length - header, beforeDates.length)), ...nowDates, ...(afterDates.slice(0, end % 7))]
}
```

è¿™æ ·æˆ‘ä»¬çš„æ•°æ®å°±å–å®Œæ•´äº†ï¼Œè¿˜æ²¡æœ‰å¤šä½™çš„ä¸œè¥¿ï¼Œå®Œç¾ï¼

### Step 5ï¼šDomåŠŸèƒ½è¡¥å…¨

è¿™é‡Œå°±æ˜¯ä¸å…¨domæ“ä½œçš„åŠŸèƒ½äº†ï¼Œç›´æ¥è´´ä»£ç 

```js
window.onload = () => {
	init()
}
// è®¾ç½®ä¸€ä¸ªå…¨å±€çš„Date()å®ä¾‹
const now = new Date()
const content = document.querySelector(".calendar-date-tbody-content")

function init() {
  // è·å–æ‰€éœ€çš„æ—¥æœŸæ•°æ®
	const totalDate = getTotalDate(now)
	initDom(totalDate)
}

function initDom(totalDate) {
	const result = []
	const divs = document.createDocumentFragment()
	let i = 0
	const total7Count = totalDate.length / 7
	const remain7Count = totalDate.length % 7
  // è¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªresultçš„äºŒç»´æ•°ç»„ï¼Œé‡Œé¢æ¯ä¸ªå…ƒç´ éƒ½æœ‰7ä¸ªæ—¥æœŸæ–¹ä¾¿æ¸²æŸ“
	while (total7Count >= i) {
		if (total7Count === i) {
			remain7Count > 0 && (result[i] = totalDate.slice(i * 7, totalDate.length))
		} else {
			result[i] = totalDate.slice(i * 7, (i + 1) * 7)
		}
		i++
	}
	// éå†äºŒç»´æ•°ç»„
	result.forEach((f) => {
    // ç»„å‡ºä¸€ä¸ªweek
		const d = combineDiv(f)
		divs.appendChild(d)
	})

	content.innerHTML = ""
  // æ·»åŠ åˆ°é¡µé¢ä¸Š
	content.appendChild(divs)
}
// æ‹¼æ¥dom
function combineDiv(f) {
	// çˆ¶èŠ‚ç‚¹
	const fDiv = document.createElement("div")
	fDiv.className = "calendar-date-tbody"

	let el = ""
	f.forEach((e) => {
		const { formateDate, month } = e
		const nowDate = format(now)
		const className = ["calendar-item"]

		el += `<div class="${className.join(" ")}" id="${formateDate}" data-year="${e.year}" data-month="${e.month}">
                                    <div class="calendar-item-header">${e.day}</div>
                                    <div class="calendar-item-content">
                                    </div>
                                </div>`
	})
	fDiv.innerHTML = el

	return fDiv
}
```



### Step 6ï¼šäº‹ä»¶è¡¥å…¨

è¿™é‡Œæˆ‘ä»¬ç»‘å®šheaderä¸Šç‚¹å‡»åˆ‡æ¢å‰åå¹´æœˆçš„æŒ‰é’®

```js
const dir = document.querySelector(".calendar-header-content")

dir.removeEventListener("click", initFunc)
dir.addEventListener("click", initFunc)

// åˆ‡æ¢å¹´æœˆçš„äº‹ä»¶ï¼Œè¿™é‡Œé¢æ²¡ä»€ä¹ˆç‰¹åˆ«è¦è¯´æ˜çš„
function initFunc(e) {
	const { target } = e
	if (target.classList.contains("calendar-header-dir")) {
		let { month = 0, year = 0 } = target.dataset
		now.setMonth(now.getMonth() + +month, 1)
		now.setFullYear(now.getFullYear() + +year)
		init()
	}
}
```

ç»‘å®šç‚¹å‡»æ—¥æœŸçš„äº‹ä»¶ï¼Œæˆ‘ä»¬ç›´æ¥ä»£ç†åˆ°å¤–å±‚çˆ¶çº§ä¸Š

```js
content.removeEventListener("click", initDateFunc)
content.addEventListener("click", initDateFunc)
let selected = format(now) // 'yyyy-MM-dd'
function initDateFunc(e) {
  // è¿™é‡Œä¸€ä¸ªå¸®åŠ©å‡½æ•°ï¼Œè·å–ç‚¹å‡»å†…å®¹çš„çˆ¶çº§
	const target = getElementByClassName(e.target, "calendar-item")
	if (target) {
		const id = target.id
		// ä¸€ä¸ªå…¨å±€å˜é‡ å¸®åŠ©åˆ¤æ–­activeçš„çŠ¶æ€ï¼Œæ˜¯ä¸æ˜¯åœ¨å½“å‰èŠ‚ç‚¹ä¸Š
		if (selected === id) {
			return
		}
		// å¦‚æœå½“å‰æœˆä»½ä¸ç­‰äºç‚¹å‡»çš„æœˆä»½ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°æ¸²æŸ“dom
		let { month, year } = target.dataset
		month = month - 1

		if (now.getMonth() !== month) {
			now.setMonth(month, 1)
			now.setFullYear(year)
			init()
		}
		// åˆ‡æ¢activeçŠ¶æ€
		document.getElementById(`${id}`).classList.add("active")
		const activeElement = document.getElementById(`${selected}`)
		activeElement && activeElement.classList.remove("active")
		selected = id
	}
}

```

è¿™æ ·æˆ‘ä»¬çš„åŠŸèƒ½åŸºæœ¬å°±å…¨éƒ¨å®Œæˆäº†



### Step 7...

**å®Œæˆäº†ä»¥ä¸ŠåŠŸèƒ½å…¶å®åªæ˜¯ä¸ªå¼€å§‹ï¼Œè¿™ä¸ªæ—¥å†ç»„ä»¶å¯ä»¥æ”¹é€ æˆvue,reactæ¡†æ¶çš„ç»„ä»¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä»¥åæ‹“å±•æ›´å¤šåŠŸèƒ½ï¼Œè¿™ä¸ªæ—¥å†åªæ˜¯å®ç°äº†ä¸€ä¸ªæ—¥å†çš„åŸºæœ¬åŠŸèƒ½è€Œå·²ï¼Œæ›´è¿œçš„è·¯åœ¨ç­‰ç€æˆ‘ä»¬ã€‚ã€‚ã€‚**